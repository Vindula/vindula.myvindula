<tal:block tal:define="userHasReplyPermission view/can_reply;
                       isDiscussionAllowed view/is_discussion_allowed;
                       isAnonymousDiscussionAllowed view/anonymous_discussion_allowed;
                       isAnon view/is_anonymous;
                       canReview view/can_review;
                       replies python:view.get_replies(canReview);
					   
                       has_replies python:view.has_replies(canReview);
                       showCommenterImage view/show_commenter_image;
                       errors options/state/getErrors|nothing;
                       wtool context/@@plone_tools/workflow;
					   
					   member python:context.portal_membership.getAuthenticatedMember();
					   logado python:str(member)!='Anonymous User';
					    
					   view_coments python:context.restrictedTraverse('@@myvindula-comments');
					   item_id view_coments/get_UID|nothing;
					   item_name_class context/portal_type;
					   member context/@@plone_portal_state/member;
					   activ_vindula context/activ_comment|nothing;
					   enable python:view_coments.discussionAllowed(isDiscussionAllowed, has_replies, activ_vindula);
					   
            		   comments python:view_coments.get_comments(item_id, item_name_class);"
					   
		   tal:condition="enable"
           i18n:domain="plone">
	
	<script type="text/javascript" src="" tal:attributes="src string:${view_coments/static}/ajax_comments-curtir.js"></script>
	<input type="hidden" id="portal_url" tal:attributes="value context/portal_url|nothing">	
	<input type="hidden" id="context_url" tal:attributes="value context/absolute_url|nothing">
	
	<div id="content">		           	
		<!-- start: Comments -->		
		<div class="geral_lista_comentarios">           		
	    	<div class="titulo_area">
				<h2 tal:content="python:'ComentÃ¡rios ('+str(comments.count())+')'"></h2>
			</div>
			<div class="descricao_titulo">
				<p>Donec nec elit ut nunc blandit convallis. Nullam quis odio eget erat tempus imperdiet et a est.</p>
			</div>
			
			<input type="hidden" id="username" name="username" value="" tal:attributes="value member">
			<div class="comments-cont">
				<tal:rep repeat="item comments">
					<div class="comment item_lista" tal:define="user_comment python: view_coments.get_prefs_user(item.username);">
						<div class="commentImage">
		                    <img src="defaultUser.png"
			             		 alt="" border="0"
			             		 height="30"
			             		 tal:attributes="src python:view_coments.get_photo_user(user_comment);
						 						 alt user_comment/name|nothing;
												 title user_comment/name|nothing;" />
		                </div>
						<div class="documentByLine name-user">
							<h4><span tal:replace="user_comment/name|nothing" /> | 
			                    <span tal:replace="python:item.date_creation.strftime('%d/%m/%Y')" />
							</h4>
		                </div>
						<div id="like" tal:condition="logado">
							<div tal:attributes="id item/id|nothing">
								<input type="hidden" name="isPlone:boolean" id="isPlone" value="False" />
								<input type="hidden" name="type" id="type" value="ModelsMyvindulaComments" />
							</div>
							<div metal:use-macro="context/myvindula-like-macro/macros/like" />
						</div>
		                <div class="commentBody">
		                    <p tal:replace="item/text|nothing" />
				  		</div>
						<div id="comments" tal:condition="logado">
							<div tal:attributes="id item/id|nothing">
								<input type="hidden" name="isPlone:boolean" id="isPlone" value="True" />
								<input type="hidden" name="type" id="type" value="ModelsMyvindulaComments" />
							</div>
							<input type="button" value="Comentar" class="comments bt_comments" tal:attributes="id item/id|nothing" />
							<div id="new-comments"></div>
						</div>
						<div metal:use-macro="context/myvindula-comments-macro/macros/comments" />
					</div>
				</tal:rep>
			</div>
			<div class="bt_comentar" tal:condition="logado">
				<input id="comentar" type="button" value="Comentar" class="">
			</div>
			<div id="comment-geral" style="display:none;" tal:condition="logado">
				<form action="" name="save-coment" tal:attributes="action string:${context/absolute_url}/myvindula-comments">
					<script type="text/javascript">
						$j('#cancel').click(function(){
							$j('#new-comments').css('display','none');
						});
						
					</script>
					
					<input type="hidden" name="id_obj" tal:attributes="value view_coments/get_UID|nothing">
					<input type="hidden" name="type" tal:attributes="value context/portal_type|nothing">
					<input type="hidden" name="isPlone:boolean" value="True">	
					<input type="hidden" name="username" value="" tal:attributes="value context/@@plone_portal_state/member|nothing">
					<textarea  style="width: 100%; height: 81px;" name="text"></textarea>

					<div class="formControls text-aling">
					  <input type="hidden" name="form.submitted-comment:boolean" value="True" />
					  <input type="button" name="cancel" value="Cancelar" id="cancel" class="context bt_comments"/>
					  <input type="submit" name="submit" value="Publicar" id="save-coment" class="context bt_comments"/>
					</div>
				</form>
			</div>
		</div>
	</div>
</tal:block>